#!/usr/bin/env bash
set -euo pipefail

# Prefer local-ci if available, while keeping strict clippy parity with fallback paths.
if command -v local-ci >/dev/null 2>&1; then
  echo "[pre-commit] running fmt via local-ci + strict clippy"
  local-ci fmt
  cargo clippy --workspace --all-targets -- -D warnings
elif command -v nix >/dev/null 2>&1; then
  echo "[pre-commit] running rust fmt + clippy via nix develop"
  nix develop --command bash -c '
    cargo fmt --all -- --check &&
    cargo clippy --workspace --all-targets -- -D warnings
  '
else
  echo "[pre-commit] running local cargo checks (no nix or local-ci)"
  cargo fmt --all -- --check
  cargo clippy --workspace --all-targets -- -D warnings
fi
