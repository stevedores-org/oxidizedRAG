#!/usr/bin/env bash
set -euo pipefail

# Prefer local-ci if available (fast cached checks)
if command -v local-ci >/dev/null 2>&1; then
  echo "[pre-commit] running fmt + clippy via local-ci"
  local-ci fmt clippy
elif command -v nix >/dev/null 2>&1; then
  echo "[pre-commit] running rust fmt + clippy via nix develop"
  nix develop --command bash -c '
    cargo fmt --all -- --check &&
    cargo clippy --workspace --all-targets -- -D warnings
  '
else
  echo "[pre-commit] running local cargo checks (no nix or local-ci)"
  cargo fmt --all -- --check
  cargo clippy --workspace --all-targets -- -D warnings
fi
