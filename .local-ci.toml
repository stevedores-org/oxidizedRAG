# local-ci configuration for oxidizedRAG
# See: https://github.com/stevedores-org/local-ci
#
# Schema: use "command" and "fix_command" (not cmd/fixcmd). See PR #126.
# Note: rustfmt.toml uses nightly-only options; for fmt to pass use
#   cargo +nightly fmt --all   (or run CI via Nix: nix flake check).
#
# Core stages run by default: fmt, clippy, test
# Optional tool stages available below (requires installation):
#   - deny: cargo-deny (security/license checking)
#   - audit: cargo-audit (CVE vulnerability scanning)
#   - machete: cargo-machete (unused dependencies)
#   - taplo: taplo-cli (TOML formatting)

[cache]
# Directories to skip when computing source hash
skip_dirs = [".git", "target", ".github", "scripts", ".claude", "node_modules", "docs", "docs-site", "docs-example", "benches"]
# File patterns to include in hash
include_patterns = ["*.rs", "*.toml"]

[stages.fmt]
command = ["cargo", "fmt", "--all", "--", "--check"]
fix_command = ["cargo", "fmt", "--all"]
timeout = 120
enabled = true

[stages.clippy]
command = ["cargo", "clippy", "--workspace", "--all-targets", "--", "-D", "warnings"]
timeout = 600
enabled = true

[stages.test]
command = ["cargo", "test", "--workspace"]
timeout = 1200
enabled = true

[stages.check]
command = ["cargo", "check", "--workspace"]
timeout = 600
enabled = false

# Optional: Cargo tools (uncomment to enable)
# Install with: cargo install cargo-deny
[stages.deny]
command = ["cargo", "deny", "check"]
timeout = 300
enabled = false

# Install with: cargo install cargo-audit
[stages.audit]
command = ["cargo", "audit"]
timeout = 300
enabled = false

# Install with: cargo install cargo-machete
[stages.machete]
command = ["cargo", "machete"]
timeout = 300
enabled = false

# Install with: cargo install taplo-cli
[stages.taplo]
command = ["taplo", "format", "--check", "."]
fix_command = ["taplo", "format", "."]
timeout = 300
enabled = false

[dependencies]
optional = []

[workspace]
exclude = []
